<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>can-eth-gw-utils Gateway Utilities: src/cegwsend/cegwsend.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="CAN-eth-GW-mini.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">can-eth-gw-utils Gateway Utilities
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">A bidirectional CAN to Ethernet Gateway (Utilities)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('cegwsend_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">cegwsend.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/version.h&gt;</code><br/>
<code>#include &lt;linux/if_ether.h&gt;</code><br/>
<code>#include &lt;getopt.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;linux/can.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;sys/socket.h&gt;</code><br/>
<code>#include &lt;arpa/inet.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;net/if.h&gt;</code><br/>
<code>#include &lt;sys/ioctl.h&gt;</code><br/>
<code>#include &lt;net/ethernet.h&gt;</code><br/>
<code>#include &lt;netpacket/packet.h&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for cegwsend.c:</div>
<div class="dyncontent">
<div class="center"><img src="cegwsend_8c__incl.png" border="0" usemap="#src_2cegwsend_2cegwsend_8c" alt=""/></div>
<map name="src_2cegwsend_2cegwsend_8c" id="src_2cegwsend_2cegwsend_8c">
</map>
</div>
</div>
<p><a href="cegwsend_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6812c1aea233f06c19e34aaf901ab7d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cegwsend_8c.html#a6812c1aea233f06c19e34aaf901ab7d7">convert_to_mac</a> (const char *string1)</td></tr>
<tr class="separator:a6812c1aea233f06c19e34aaf901ab7d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ff0b79d96423fac3426976845b269fe"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cegwsend_8c.html#a3ff0b79d96423fac3426976845b269fe">die</a> (const char *msg)</td></tr>
<tr class="separator:a3ff0b79d96423fac3426976845b269fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cegwsend_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a56e9da5aa5c0c213afa3a5d84a682aa4"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cegwsend_8c.html#a56e9da5aa5c0c213afa3a5d84a682aa4">mac</a></td></tr>
<tr class="separator:a56e9da5aa5c0c213afa3a5d84a682aa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a6812c1aea233f06c19e34aaf901ab7d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void convert_to_mac </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>string1</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>convert_to_mac converts a string from the console to a MAC address with the length of 6 bytes </p>
<p>i is used in the for loop</p>
<p>A MAC address has the length of 6 Bytes. We need to allocate enough memory to store it.</p>

<p>Definition at line <a class="el" href="cegwsend_8c_source.html#l00023">23</a> of file <a class="el" href="cegwsend_8c_source.html">cegwsend.c</a>.</p>

<p>References <a class="el" href="cegwsend_8c_source.html#l00017">mac</a>.</p>

<p>Referenced by <a class="el" href="cegwsend_8c_source.html#l00050">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordtype">char</span>* string2;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="cegwsend_8c.html#a56e9da5aa5c0c213afa3a5d84a682aa4">mac</a> = (<span class="keywordtype">char</span> *) malloc(6);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="cegwsend_8c.html#a56e9da5aa5c0c213afa3a5d84a682aa4">mac</a>[0] = strtoul(string1, &amp;string2, 16);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">for</span>(i = 1; i &lt;= 5; i++){</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <a class="code" href="cegwsend_8c.html#a56e9da5aa5c0c213afa3a5d84a682aa4">mac</a>[i] = strtoul(string2 + 1, &amp;string2, 16);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cegwsend_8c_a6812c1aea233f06c19e34aaf901ab7d7_icgraph.png" border="0" usemap="#cegwsend_8c_a6812c1aea233f06c19e34aaf901ab7d7_icgraph" alt=""/></div>
<map name="cegwsend_8c_a6812c1aea233f06c19e34aaf901ab7d7_icgraph" id="cegwsend_8c_a6812c1aea233f06c19e34aaf901ab7d7_icgraph">
<area shape="rect" id="node3" href="cegwsend_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="168,5,219,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3ff0b79d96423fac3426976845b269fe"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void die </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="cegwsend_8c.html#a3ff0b79d96423fac3426976845b269fe">die()</a> is called in case of a failure. It prints the error message and exits the program </p>

<p>Definition at line <a class="el" href="cegwsend_8c_source.html#l00044">44</a> of file <a class="el" href="cegwsend_8c_source.html">cegwsend.c</a>.</p>

<p>Referenced by <a class="el" href="cegwsend_8c_source.html#l00050">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    perror(msg);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cegwsend_8c_a3ff0b79d96423fac3426976845b269fe_icgraph.png" border="0" usemap="#cegwsend_8c_a3ff0b79d96423fac3426976845b269fe_icgraph" alt=""/></div>
<map name="cegwsend_8c_a3ff0b79d96423fac3426976845b269fe_icgraph" id="cegwsend_8c_a3ff0b79d96423fac3426976845b269fe_icgraph">
<area shape="rect" id="node3" href="cegwsend_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="93,5,144,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>c is used for calling getopt_long()</p>
<p>src points at the beginning of the memory space in which the MAC address of the message's receiver will be written</p>
<p>dest points at the beginning of the memory space in which the MAC address of the message's sender will be written</p>
<p>type is the identifier of the EtherType</p>
<p>raw_index points at the beginning of the raw data in argv[]. If raw_index == -1, then no data exists</p>
<p>name_index is the index of argv in which the name of the ethernet device begins. If name_index == -1, then there is no name</p>
<p>getopt_long is used here for reading the arguments from the command line</p>
<p>source MAC address</p>
<p>destination MAC address</p>
<p>packet type ID field</p>
<p>raw data</p>
<p>name of the network interface</p>
<p>Detect the end of the options.</p>
<p>If this option set a flag, do nothing else now.</p>
<p>convert the argument to a valid MAC address</p>
<p>convert_to_mac writes the address down in mac. It must be stored in src now.</p>
<p>convert the argument to al valid MAC address</p>
<p>convert_to_mac writes the address down in mac. It must be stored in dest now.</p>
<p>The EtherType is defined by a number with the length of 2 Bytes (e. g. 0x8000 for the Internet Protocol). The argument from the console must be converted to a number. This happens here.</p>
<p>The EtherType of Internet Protocol, Version 4 is 0x0800</p>
<p>The EtherType of Internet Protocol, Version 6 is 0x86DD</p>
<p>The EtherType of Controller Area Network is 0x000C</p>
<p>The EtherType of CAN flexible data rate is 0x000D</p>
<p>If the identifier was typed in like "0x1234" we cut off the 0x and convert the number. If instead it was written down like "1234" we simply convert the argument from the console to a number.</p>
<p>getopt_long already printed error message-</p>
<p>mac is not needed anymore</p>
<p>Create the AF_PACKET socket</p>
<p>In case of a failure the allocated memory must be freed and die is called</p>
<p>Name/index number of the interface If there is no name, we have a problem and the program must end</p>
<p>Construct the destination address</p>
<p>dest is not needed anymore</p>
<p>Now, finally, let's send the data, if it exists, of course</p>
<p>Nerver forget to free the allocated memory</p>

<p>Definition at line <a class="el" href="cegwsend_8c_source.html#l00050">50</a> of file <a class="el" href="cegwsend_8c_source.html">cegwsend.c</a>.</p>

<p>References <a class="el" href="cegwsend_8c_source.html#l00023">convert_to_mac()</a>, <a class="el" href="cegwsend_8c_source.html#l00044">die()</a>, and <a class="el" href="cegwsend_8c_source.html#l00017">mac</a>.</p>
<div class="fragment"><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;{</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordtype">int</span> c;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordtype">char</span> *src;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    src = (<span class="keywordtype">char</span> *) malloc(6);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">char</span> *dest;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    dest = (<span class="keywordtype">char</span> *) malloc(6);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    ushort type;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">int</span> raw_index = -1;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">int</span> name_index = -1;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">while</span> (1){</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keyword">static</span> <span class="keyword">struct </span>option long_options[] = {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            {<span class="stringliteral">&quot;src&quot;</span>, required_argument, 0, <span class="charliteral">&#39;s&#39;</span>},</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            {<span class="stringliteral">&quot;dst&quot;</span>, required_argument, 0, <span class="charliteral">&#39;d&#39;</span>},</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            {<span class="stringliteral">&quot;type&quot;</span>, required_argument, 0, <span class="charliteral">&#39;t&#39;</span>},</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            {<span class="stringliteral">&quot;raw&quot;</span>, required_argument, 0, <span class="charliteral">&#39;r&#39;</span>},</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            {<span class="stringliteral">&quot;name&quot;</span>, required_argument, 0, <span class="charliteral">&#39;n&#39;</span>},</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            {0, 0, 0, 0}</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        };</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="comment">/* getopt_long stores the option index here. */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordtype">int</span> option_index = 0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        c = getopt_long(argc, argv, <span class="stringliteral">&quot;s:d:t:r:n:&quot;</span>, long_options, &amp;option_index);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">if</span>(c == -1)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keywordflow">switch</span> (c){</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <span class="keywordflow">if</span>(long_options[option_index].flag != 0)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                printf(<span class="stringliteral">&quot;option %s&quot;</span>, long_options[option_index].name);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="keywordflow">if</span>(optarg)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                    printf(<span class="stringliteral">&quot; with arg %s&quot;</span>, optarg);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                printf(<span class="stringliteral">&quot;option -s with value `%s&#39;\n&quot;</span>, optarg);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <a class="code" href="cegwsend_8c.html#a6812c1aea233f06c19e34aaf901ab7d7">convert_to_mac</a>(optarg);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                memcpy(src, <a class="code" href="cegwsend_8c.html#a56e9da5aa5c0c213afa3a5d84a682aa4">mac</a>, 6);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                printf(<span class="stringliteral">&quot;option -d with value `%s&#39;\n&quot;</span>, optarg);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <a class="code" href="cegwsend_8c.html#a6812c1aea233f06c19e34aaf901ab7d7">convert_to_mac</a>(optarg);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                memcpy(dest, <a class="code" href="cegwsend_8c.html#a56e9da5aa5c0c213afa3a5d84a682aa4">mac</a>, 6);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                printf(<span class="stringliteral">&quot;option -t with value `%s&#39;\n&quot;</span>, optarg);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="keywordflow">if</span>(strcmp(optarg, <span class="stringliteral">&quot;ipv4&quot;</span>) == 0){</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                    type = 0x0800;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(optarg, <span class="stringliteral">&quot;ipv6&quot;</span>) == 0){</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    type = 0x86DD;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(optarg, <span class="stringliteral">&quot;can&quot;</span>) == 0){</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                    type = 0x000C;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(optarg, <span class="stringliteral">&quot;canfd&quot;</span>) == 0){</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    type = 0x000D;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(optarg, <span class="stringliteral">&quot;0x&quot;</span>, 2) == 0){</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                    type = strtoul(optarg + 2, &amp;optarg, 16);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                    type = strtoul(optarg, &amp;optarg, 16);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                printf(<span class="stringliteral">&quot;option -r with value `%s&#39;\n&quot;</span>, optarg);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                raw_index = optind - 1;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                printf(<span class="stringliteral">&quot;option -n with value `%s&#39;\n&quot;</span>, optarg);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                name_index = optind - 1;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                abort();</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    free(<a class="code" href="cegwsend_8c.html#a56e9da5aa5c0c213afa3a5d84a682aa4">mac</a>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    printf(<span class="stringliteral">&quot;source: %hhX&quot;</span>, *src);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX&quot;</span>, *(src + 1));</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX&quot;</span>, *(src + 2));</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX&quot;</span>, *(src + 3));</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX&quot;</span>, *(src + 4));</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX\n&quot;</span>, *(src + 5));</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    printf(<span class="stringliteral">&quot;destination: %hhX&quot;</span>, *dest);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX&quot;</span>, *(dest + 1));</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX&quot;</span>, *(dest + 2));</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX&quot;</span>, *(dest + 3));</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX&quot;</span>, *(dest + 4));</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    printf(<span class="stringliteral">&quot;:%hhX\n&quot;</span>, *(dest + 5));</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    printf(<span class="stringliteral">&quot;type: %hX \n&quot;</span>, type);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordtype">int</span> fd = socket(AF_PACKET, SOCK_DGRAM, htons(type));</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span> (fd == -1){</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        free(dest);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        free(src);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <a class="code" href="cegwsend_8c.html#a3ff0b79d96423fac3426976845b269fe">die</a>(strerror(errno));</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span>(name_index == -1){</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        free(dest);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        free(src);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <a class="code" href="cegwsend_8c.html#a3ff0b79d96423fac3426976845b269fe">die</a>(<span class="stringliteral">&quot;name/index number of the network interface required&quot;</span>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keyword">struct </span>ifreq ifr;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">size_t</span> if_name_len = strlen(argv[name_index]);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span>(if_name_len &lt; <span class="keyword">sizeof</span>(ifr.ifr_name)){</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        memcpy(ifr.ifr_name, argv[name_index], if_name_len);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        ifr.ifr_name[if_name_len] = 0;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        printf(<span class="stringliteral">&quot;sizeof(ifr.ifr_name): %d&quot;</span>, <span class="keyword">sizeof</span>(ifr.ifr_name));</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        printf(<span class="stringliteral">&quot; sollte groesser sein als if_name_len: %d&quot;</span>, if_name_len);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        free(src);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        free(dest);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <a class="code" href="cegwsend_8c.html#a3ff0b79d96423fac3426976845b269fe">die</a>(<span class="stringliteral">&quot;interface name is too long&quot;</span>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">if</span>(ioctl(fd, SIOCGIFINDEX, &amp;ifr) == -1){</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        free(src);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        free(dest);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <a class="code" href="cegwsend_8c.html#a3ff0b79d96423fac3426976845b269fe">die</a>(strerror(errno));</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">int</span> ifindex = ifr.ifr_ifindex;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keyword">struct </span>sockaddr_ll addr = {0};</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    addr.sll_family = AF_PACKET;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    addr.sll_ifindex = ifindex;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    addr.sll_halen = ETHER_ADDR_LEN;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    addr.sll_protocol = htons(type);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    memcpy(addr.sll_addr, dest, ETHER_ADDR_LEN);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    free(dest);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">if</span>(raw_index == -1){</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        free(src);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="cegwsend_8c.html#a3ff0b79d96423fac3426976845b269fe">die</a>(<span class="stringliteral">&quot;No data to be sent&quot;</span>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span>(sendto(fd, argv[raw_index], strlen(argv[raw_index]), 0, (<span class="keyword">struct</span> sockaddr*)&amp;addr, <span class="keyword">sizeof</span>(addr)) == -1){</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        free(src);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="cegwsend_8c.html#a3ff0b79d96423fac3426976845b269fe">die</a>(strerror(errno));</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    free(src);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cegwsend_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph.png" border="0" usemap="#cegwsend_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph" alt=""/></div>
<map name="cegwsend_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph" id="cegwsend_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph">
<area shape="rect" id="node3" href="cegwsend_8c.html#a6812c1aea233f06c19e34aaf901ab7d7" title="convert_to_mac" alt="" coords="104,5,219,35"/><area shape="rect" id="node5" href="cegwsend_8c.html#a3ff0b79d96423fac3426976845b269fe" title="die" alt="" coords="143,59,180,88"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a56e9da5aa5c0c213afa3a5d84a682aa4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* mac</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cegwsend_8c_source.html#l00017">17</a> of file <a class="el" href="cegwsend_8c_source.html">cegwsend.c</a>.</p>

<p>Referenced by <a class="el" href="cegwsend_8c_source.html#l00023">convert_to_mac()</a>, and <a class="el" href="cegwsend_8c_source.html#l00050">main()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_de3b884c9ad7132e0c6e4ed7ddd27729.html">cegwsend</a></li><li class="navelem"><a class="el" href="cegwsend_8c.html">cegwsend.c</a></li>
    <li class="footer">Generated on Mon Jul 15 2013 22:44:00 for can-eth-gw-utils Gateway Utilities by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
